---
title: "1358. åŒ…å«æ‰€æœ‰ä¸‰ç§å­—ç¬¦çš„å­å­—ç¬¦ä¸²æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰"
alise: "1358. åŒ…å«æ‰€æœ‰ä¸‰ç§å­—ç¬¦çš„å­å­—ç¬¦ä¸²æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰"
source: "https://leetcode.cn/problems/number-of-substrings-containing-all-three-characters/description/"
created: 2025-10-08
author:
  - "[[åŠ›æ‰£ LeetCode]]"
description: "1358. åŒ…å«æ‰€æœ‰ä¸‰ç§å­—ç¬¦çš„å­å­—ç¬¦ä¸²æ•°ç›® - ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sÂ ï¼Œå®ƒåªåŒ…å«ä¸‰ç§å­—ç¬¦ a, b å’Œ c ã€‚è¯·ä½ è¿”å› aï¼Œb å’Œ c éƒ½Â è‡³å°‘Â å‡ºç°è¿‡ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²æ•°ç›®ã€‚Â ç¤ºä¾‹ 1ï¼šè¾“å…¥ï¼šs = \"abcabc\"è¾“å‡ºï¼š10è§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º \"abc\", \"abca\", \"abcab\", \"abcabc\", \"bca\", \"bcab\", \"bcabc\", \"cab\", \"cabc\" å’Œ \"abc\" (ç›¸åŒå­—ç¬¦ä¸²ç®—å¤šæ¬¡)ã€‚ç¤ºä¾‹ 2ï¼šè¾“å…¥ï¼šs = \"aaacb\"è¾“å‡ºï¼š3è§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º \"aaacb\", \"aacb\" å’Œ \"acb\" ã€‚ç¤ºä¾‹ 3ï¼šè¾“å…¥ï¼šs = \"abc\"è¾“å‡ºï¼š1Â æç¤ºï¼š * 3 <= s.length <= 5 x 10^4 * sÂ åªåŒ…å«å­—ç¬¦ aï¼Œb å’Œ c ã€‚"
tags:
  - "binary tree"
  - "prefix sum"
---

[1358\. åŒ…å«æ‰€æœ‰ä¸‰ç§å­—ç¬¦çš„å­å­—ç¬¦ä¸²æ•°ç›®](https://leetcode.cn/problems/number-of-substrings-containing-all-three-characters/)

1646

ç›¸å…³æ ‡ç­¾

ç›¸å…³ä¼ä¸š

æç¤º

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `s` ï¼Œå®ƒåªåŒ…å«ä¸‰ç§å­—ç¬¦ a, b å’Œ c ã€‚

è¯·ä½ è¿”å› aï¼Œb å’Œ c éƒ½ **è‡³å°‘** å‡ºç°è¿‡ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²æ•°ç›®ã€‚

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šs = "abcabc"
è¾“å‡ºï¼š10
è§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º "abc", "abca", "abcab", "abcabc", "bca", "bcab", "bcabc", "cab", "cabc" å’Œ "abc" (ç›¸åŒå­—ç¬¦ä¸²ç®—å¤šæ¬¡)ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šs = "aaacb"
è¾“å‡ºï¼š3
è§£é‡Šï¼šåŒ…å« aï¼Œb å’Œ c å„è‡³å°‘ä¸€æ¬¡çš„å­å­—ç¬¦ä¸²ä¸º "aaacb", "aacb" å’Œ "acb" ã€‚
```

**ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šs = "abc"
è¾“å‡ºï¼š1
```

**æç¤ºï¼š**

- `3 <= s.length <= 5 x 10^4`
- `s` åªåŒ…å«å­—ç¬¦ aï¼Œb å’Œ c ã€‚

---

é¢è¯•ä¸­é‡åˆ°è¿‡è¿™é“é¢˜?

1/5

æ˜¯

å¦

é€šè¿‡æ¬¡æ•°

28,359 /43.5K

é€šè¿‡ç‡

65.2 %

---

---

ç›¸å…³ä¼ä¸š

---

æç¤º1

For each position we simply need to find the first occurrence of a/b/c on or after this position.

---

æç¤º2

So we can pre-compute three link-list of indices of each a, b, and c.

---

---

è¯„è®º (148)

ğŸ’¡ è®¨è®ºåŒºè§„åˆ™

1\. è¯·ä¸è¦åœ¨è¯„è®ºåŒºå‘è¡¨é¢˜è§£ï¼

2\. è¯„è®ºåŒºå¯ä»¥å‘è¡¨å…³äºå¯¹ç¿»è¯‘çš„å»ºè®®ã€å¯¹é¢˜ç›®çš„ç–‘é—®åŠå…¶å»¶ä¼¸è®¨è®ºã€‚

3\. å¦‚æœä½ éœ€è¦æ•´ç†é¢˜è§£æ€è·¯ï¼Œè·å¾—åé¦ˆä»è€Œè¿›é˜¶æå‡ï¼Œå¯ä»¥å»é¢˜è§£åŒºè¿›è¡Œã€‚

[Mistletoe](https://leetcode.cn/u/mistletoe-hv/)

æ¥è‡ª ç¾å›½

2024.10.18

åªè¦rightæŒ‡é’ˆæ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªåŒ…å«ä¸‰ç§å­—ç¬¦çš„ä½ç½®ï¼Œé‚£ä¹ˆä»è¿™ä¸ªä½ç½®å¼€å§‹åˆ°å­—ç¬¦ä¸²æœ«å°¾ä½ç½®éƒ½æ˜¯ç¬¦åˆè¦æ±‚çš„å­ä¸²çš„æœ«å°¾ä½ç½®ï¼Œä¸ªæ•°ä¸ºn-rightï¼Œç„¶åå°±å¯ä»¥å³ç§»leftæŒ‡é’ˆäº†

```cpp
class Solution {
    public int numberOfSubstrings(String s) {
        int n = s.length();
        int[] cnt = new int[3];
        int left = 0, res = 0;
        for (int right = 0; right < n; right++) {
            cnt[s.charAt(right) - 'a']++;
            while (cnt[0] > 0 && cnt[1] > 0 && cnt[2] > 0) {
                res += n - right;
                cnt[s.charAt(left) - 'a']--;
                left++;
            }
        }
        return res;
    }
}
```

å±•å¼€å…¨éƒ¨

7

å±•ç¤º 1 æ¡å›å¤

å›å¤

[åƒæ¥¼](https://leetcode.cn/u/wei-lai-27/)

æ¥è‡ª å¹¿ä¸œ

2025.06.30

å‡è®¾ä»¥iç»“å°¾çš„å­ä¸²\[L,i\]ä¸ºæœ€çŸ­æ»¡è¶³å­ä¸²ï¼Œåˆ™\[0,i\] \[1, i\], \[2, i\]... \[L, i\]éƒ½æ˜¯æ»¡è¶³å­ä¸²ï¼Œ è¿™äº›å­ä¸²çš„å…±åŒç‚¹æ˜¯ä»¥iç»“å°¾

1

å›å¤

[ç”Ÿå¦‚å¤èŠ±](https://leetcode.cn/u/If9rgEQ852/)

æ¥è‡ª å±±è¥¿

2025.02.11

æ‰§è¡Œç”¨æ—¶åˆ†å¸ƒ: 2388ms  
å‡»è´¥:5.20%  
æ¶ˆè€—å†…å­˜åˆ†å¸ƒ:  
44.72  
MB  
å‡»è´¥:  
5.20%

å“‡åœ°ä¸€å£°å“­äº†å‡ºæ¥

2

å±•ç¤º 2 æ¡å›å¤

å›å¤

[KZHU](https://leetcode.cn/u/2s1mple/)

æ¥è‡ª ç¾å›½

2024.04.21

javaæ»‘åŠ¨çª—å£+æ³¨é‡Š çœ‹ä¸æ‡‚æ‰“æˆ‘

```java
class Solution {
    public int numberOfSubstrings(String s) {
        char[] c = s.toCharArray();  // å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå­—ç¬¦æ•°ç»„
        int[] count = new int['d'];  // è®¡æ•°æ•°ç»„ï¼Œåªå…³å¿ƒ'a','b','c'çš„å‡ºç°æ¬¡æ•°
        int left = 0, ans = 0;       // leftä¸ºæ»‘åŠ¨çª—å£çš„å·¦è¾¹ç•Œï¼Œansä¸ºç­”æ¡ˆ

        // rightä¸ºæ»‘åŠ¨çª—å£çš„å³è¾¹ç•Œ
        for (int right = 0; right < c.length; right++) {
            count[c[right]]++;      // å°†å³è¾¹ç•Œçš„å­—ç¬¦çº³å…¥è®¡æ•°

            // å½“çª—å£åŒ…å«æ‰€æœ‰'a','b','c'æ—¶ï¼Œå°è¯•ç¼©å°çª—å£å¤§å°
            while (count['a'] > 0 && count['b'] > 0 && count['c'] > 0) {
                count[c[left++]]--;  // ç§»åŠ¨çª—å£å·¦è¾¹ç•Œï¼Œå‡å°‘è¯¥å­—ç¬¦çš„è®¡æ•°
            }

            // æ‰€æœ‰ä»0åˆ°left-1å¼€å§‹ï¼Œåˆ°rightç»“æŸçš„å­ä¸²éƒ½æ˜¯æœ‰æ•ˆçš„
            ans += left;
        }
        return ans;  // è¿”å›æœ‰æ•ˆå­ä¸²çš„æ•°é‡
    }
}
```

å±•å¼€å…¨éƒ¨

5

å±•ç¤º 4 æ¡å›å¤

å›å¤

[W1LL1ng](https://leetcode.cn/u/than-sing/)

æ¥è‡ª ä¸­å›½é¦™æ¸¯

2024.08.06

æ‰¾åˆ°é—®é¢˜ä¸­çš„å•è°ƒæ€§ï¼Œå†åº”ç”¨æ»‘åŠ¨çª—å£ï¼š

å¦‚æœå°† `right` åŠ å…¥æ»‘çª—ä¹‹åï¼Œ **æ°å¥½** ä½¿å¾— `[left, ..., right]` ä¸­æœ‰è¿™ä¸‰ç§å­—ç¬¦ï¼Œé‚£ä¹ˆ `n - right` å°±æ˜¯æ‰€æœ‰ä»¥ `left` ä¸ºå·¦è¾¹ç•Œä¸”ç¬¦åˆæ¡ä»¶çš„å­åˆ—ä¸ªæ•°ã€‚è®© `right` ä»å·¦å¼€å§‹éå†ï¼Œ `left` ä¿æŒé€’å¢ï¼Œåˆ™èƒ½ç»´æŠ¤ä¸Šé¢æåˆ°çš„ **æ°å¥½** æ€§è´¨ã€‚

```python
class Solution:
    def numberOfSubstrings(self, s: str) -> int:
        ans = 0
        n = len(s)
        
        left = 0
        count = Counter()
        for right in range(n):
            count[s[right]] += 1
            while len(count) == 3:
                ans += n - right # count for every 'left'
                count[s[left]] -= 1
                if count[s[left]] == 0:
                    del count[s[left]]
                left += 1
        
        return ans
```

å±•å¼€å…¨éƒ¨

4

å›å¤

[FÄKÄƒ](https://leetcode.cn/u/allenz-me/)

æ¥è‡ª æœªçŸ¥å½’å±åœ°

2020.02.23

```java
class Solution {
    public int numberOfSubstrings(String s) {
        int res = 0;
        // è®°å½• 'a', 'b', 'c' ä¸Šæ¬¡å‡ºç°çš„ä½ç½®
        int[] record = {-1, -1, -1}; 
        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == 'a') {
                res += Math.min(record[1], record[2]) + 1;
            } else if (s.charAt(i) == 'b') {
                res += Math.min(record[0], record[2]) + 1;
            } else {
                res += Math.min(record[0], record[1]) + 1;
            }
            // æ›´æ–° 'a', 'b', 'c' æœ€è¿‘å‡ºç°çš„ä½ç½®
            record[s.charAt(i) - 'a'] = i;
        }
        return res;
    }
}
```

ä»¥ç´¢å¼• i éå†å­—ç¬¦ä¸² s ï¼Œè€ƒè™‘å­ä¸² (k, i) æ»¡è¶³æ¡ä»¶çš„æœ€å¤§ kï¼Œé‚£ä¹ˆæ­¤æ—¶å­ä¸²(0, i),...(k-1, i) ä¹Ÿæ˜¯ç¬¦åˆæ¡ä»¶çš„å­ä¸²

å±•å¼€å…¨éƒ¨

30

å±•ç¤º 5 æ¡å›å¤

å›å¤

[è·¨ææ–™ä¸åˆ·äº†](https://leetcode.cn/u/NEXTREASON/)

æ¥è‡ª ä¸­å›½ (ç¼–è¾‘è¿‡)

2021.07.31

æ»‘åŠ¨çª—å£å¸¸ç”¨æ¨¡æ¿ ï¼ˆå‹¿å¿˜ï¼‰

```java
public int numberOfSubstrings(String s) {

        int answer = 0;
        int[] counts = new int[3];
        char[] chars = s.toCharArray();

        for (int left = 0, right = 0; right < chars.length; right++) {

            counts[chars[right] - 'a']++;
            while (counts[0] > 0 && counts[1] > 0 && counts[2] > 0) {
                counts[chars[left++] - 'a']--;
                answer += chars.length - right;
            }

        }

        return answer;

    }
```

ä¸€å¹´åŠååˆåˆ·åˆ°è¿™é¢˜ï¼Œç»“æœåšé¢˜æ€è·¯å˜äº†ä¸ªæ ·ï¼Œä¸‹é¢æ˜¯æœ€æ–°çš„ä»£ç 

```java
class Solution {
    public int numberOfSubstrings(String s) {

        int[] lasts = new int[]{-1, -1, -1};

        int result = 0;
        for (int i = 0; i < s.length(); i++) {
            lasts[s.charAt(i) - 'a'] = i;
            result += Arrays.stream(lasts).min().getAsInt() + 1;
        }
        return result;

    }
}
```

å±•å¼€å…¨éƒ¨

10

å›å¤

[Nathan](https://leetcode.cn/u/nathan-41/)

æ¥è‡ª åŒ—äº¬å¸‚ (ç¼–è¾‘è¿‡)

2025.03.11

å…¶å®ä¸ç”¨æ»‘çš„â€¦â€¦

```cpp
class Solution {
public:
    int numberOfSubstrings(string s) {
        int last[3]{}, n = s.size(), count = 0;
        for (int i = 0; i < n; ++i) {
            last[s[i] - 'a'] = i + 1;
            count += *min_element(last, last + 3);
        }
        return count;
    }
};
```

å±•å¼€å…¨éƒ¨

0

å±•ç¤º 1 æ¡å›å¤

å›å¤

[æ·¡æ·¡å¿§ä¼¤](https://leetcode.cn/u/dan-dan-you-shang/)

æ¥è‡ª æµ™æ±Ÿ (ç¼–è¾‘è¿‡)

2021.11.10

æ„Ÿè§‰è‡ªå·±æ•°å­¦å›å½’å°å­¦æ°´å¹³ã€‚ã€‚ã€‚  
åˆ†æï¼šå› ä¸ºæ˜¯æ‰¾æ‰€æœ‰æ•°é‡ï¼Œè€Œå¦‚æœæŸä¸ªå‰ç¼€ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆåé¢å†åŠ ä¹Ÿç¬¦åˆè¦æ±‚ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„èµ·å§‹å‰ç¼€å’Œèµ·å§‹é•¿åº¦å³å¯

```cpp
class Solution {
    public int numberOfSubstrings(String s) {
        int n = s.length();
        if(n < 3){
            return 0;
        }

        char[] sa = s.toCharArray();
        int[] cnt = new int[3];
        int left = 0, right = 0;
        int res = 0;

        while(right < n){
            ++cnt[sa[right] - 'a'];
            while(cnt[0] * cnt[1] * cnt[2] >= 1){
                res += n - right;
                --cnt[sa[left] - 'a'];
                ++left;
            }
            ++right;
        }

        return res;
    }
}
```

å±•å¼€å…¨éƒ¨

3

å±•ç¤º 1 æ¡å›å¤

å›å¤

---

è´¡çŒ®è€… ![](https://static.leetcode-cn.com/cn-legacy-assets/images/LeetCode_avatar.png?x-oss-process=image%2Fformat%2Cwebp)

Â© 2025 é¢†æ‰£ç½‘ç»œï¼ˆä¸Šæµ·ï¼‰æœ‰é™å…¬å¸

6äººåœ¨çº¿

å·²å­˜å‚¨

è¡Œ 1ï¼Œåˆ— 1

s =

"abcabc"

"abcabc"

"aaacb"

"abc"

Source

è·Ÿéšç³»ç»Ÿ

æµ…è‰²

æ·±è‰²

ğŸ’¬ ğŸ“‹ ğŸ—‘ï¸
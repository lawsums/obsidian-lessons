
# 以太网交换机帧转发核心知识解析
## 一、交换机转发帧的核心过程
交换机基于“MAC地址表”（记录设备MAC地址与交换机端口的映射关系）实现帧转发，核心步骤可概括为3步：
1. **学习（Learning）**：接收端口收到数据帧后，提取帧头中的“源MAC地址”，将其与接收端口绑定，更新到MAC地址表（若地址已存在则刷新老化时间，默认老化时间通常为5分钟）。
2. **查找（Lookup）**：提取帧头中的“目的MAC地址”，在MAC地址表中查找对应的端口：
   - 若找到对应端口（且目的端口≠接收端口），则向该端口转发帧；
   - 若未找到对应端口（未知目的MAC），则向除接收端口外的所有端口“泛洪”（Flooding）；
   - 若目的MAC是“广播MAC（FF-FF-FF-FF-FF-FF）”，直接泛洪。
3. **转发（Forwarding）**：根据查找结果执行转发，同时丢弃无效帧（如帧长度异常、CRC校验错误的帧）。


## 二、三种帧转发方式及特点
交换机的转发方式核心差异在于“是否等待接收完整帧”，具体对比如下：

| 转发方式       | 核心逻辑                                                                 | 优点                          | 缺点                                  | 适用场景                  |
|----------------|--------------------------------------------------------------------------|-------------------------------|---------------------------------------|---------------------------|
| **存储转发（Store-and-Forward）** | 接收完整数据帧→校验CRC（确认帧无错误）→提取目的MAC→转发                 | 过滤错误帧，不占用下游带宽    | 转发时延最长（需等待完整帧接收+校验） | 对数据可靠性要求高的场景（如企业网、服务器集群） |
| **直通转发（Cut-Through）**       | 接收帧头（仅前14字节，含目的MAC）→立即查找MAC表→转发（无需等完整帧）     | 转发时延最短，实时性强        | 无法过滤错误帧，若帧错误会“错传”      | 对实时性要求高、错误率低的场景（如视频监控、工业控制） |
| **无碎片转发（Fragment-Free）**   | 接收帧的前64字节（以太网最小帧长，碎片帧均小于64字节）→校验→转发         | 兼顾时延与可靠性（过滤碎片帧） | 仍可能转发64字节后出错的帧，时延中等  | 平衡实时性与可靠性的通用场景（如办公网） |


## 三、碎片帧的含义
以太网规定**最小有效帧长为64字节**（含帧头14字节+数据46~1500字节+FCS校验4字节），**碎片帧（Fragment）指长度小于64字节的以太网帧**。  
碎片帧通常是“不完整的帧”，多由以下原因产生：
- 发送端发送帧时异常中断；
- 网络中设备故障导致帧被截断；
- 冲突（CSMA/CD机制下）产生的残缺帧。  
交换机（尤其存储转发、无碎片转发方式）会直接丢弃碎片帧，避免无效数据占用带宽。


## 四、转发时延计算（关键公式）
转发时延=“帧接收时间”+“处理时延”（处理时延通常忽略，或题目明确给出时计入），核心是**帧接收时间的计算**，公式为：  
**帧接收时间 = 帧长度（bit） / 端口带宽（bit/s）**  

不同转发方式的时延差异，本质是“接收的帧数据量不同”：
1. **存储转发时延**：需接收完整帧，因此帧接收时间=完整帧长度（bit）/带宽；  
   例：100Mbps端口转发1518字节（最大以太网帧，含18字节帧头+FCS）的帧，时延=（1518×8bit）/100×10⁶bit/s=121.44μs。
2. **直通转发时延**：仅接收帧头（14字节），帧接收时间=14×8bit/带宽；  
   例：同上端口，时延=（14×8）/100×10⁶=1.12μs。
3. **无碎片转发时延**：需接收前64字节，帧接收时间=64×8bit/带宽；  
   例：同上端口，时延=（64×8）/100×10⁶=5.12μs。  

（注：计算时需统一单位，1字节=8bit，1Mbps=10⁶bit/s）